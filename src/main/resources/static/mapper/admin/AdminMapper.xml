<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bookstore.admin.mapper.AdminMapper">

    <insert id="enrollBook" parameterType="com.bookstore.admin.domain.BookDto">
        INSERT INTO book(book_title, book_price, book_publisher, book_author, book_publishingDate, book_category, book_content, book_stock, book_pictureUrl, book_thumbUrl)
        VALUES (#{bookTitle}, #{bookPrice}, #{bookPublisher}, #{bookAuthor}, #{bookPublishingDate}, #{bookCategory}, #{bookContent}, #{bookStock}, #{bookPictureUrl}, #{bookThumbUrl});
    </insert>

    <select id="countBookList" resultType="int">
        SELECT COUNT(*)
        FROM book
    </select>

    <select id="bookList" parameterType="map" resultType="com.bookstore.admin.domain.BookDto">
        SELECT *
        FROM book
        ORDER BY book_num DESC
        LIMIT #{offset}, #{pageSize}
    </select>

    <select id="searchBookDetailByBookNum" parameterType="int" resultType="com.bookstore.admin.domain.BookDto">
        SELECT *
        FROM book
        WHERE book_num = #{bookNum}
    </select>

    <select id="searchSelectPage" parameterType="com.bookstore.common.utils.SearchCondition" resultType="com.bookstore.admin.domain.BookDto">
        SELECT *
        FROM  book
        WHERE true
        <include refid="searchCondition"/>
        ORDER BY book_num DESC
        LIMIT #{offset}, #{pageSize}
    </select>

    <select id="searchResultCnt" parameterType="com.bookstore.common.utils.SearchCondition" resultType="int">
        SELECT count(*)
        FROM  book
        WHERE true
        <include refid="searchCondition"/>
    </select>

    <sql id="searchCondition">
        <choose>
            <when test='option=="T"'>
                AND book_title LIKE concat('%', #{keyword}, '%')
            </when>
            <when test='option=="W"'>
                AND book_author LIKE concat('%', #{keyword}, '%')
            </when>
            <otherwise>
                AND (book_title   LIKE concat('%', #{keyword}, '%')
                OR   book_content LIKE concat('%', #{keyword}, '%'))
            </otherwise>
        </choose>
    </sql>

    <update id="bookUpdate" parameterType="com.bookstore.admin.domain.BookDto">
        UPDATE book
        SET book_title = #{bookTitle}, book_author = #{bookAuthor}, book_publisher = #{bookPublisher}, book_publishingDate = #{bookPublishingDate},
            book_price = #{bookPrice}, book_content = #{bookContent}, book_category = #{bookCategory}, book_stock = #{bookStock},
            book_pictureUrl = #{bookPictureUrl}, book_thumbUrl = #{bookThumbUrl}
        WHERE book_num = #{bookNum}
    </update>

    <delete id="bookRemove" parameterType="int">
        DELETE
        FROM book
        WHERE book_num = #{bookNum}
    </delete>


</mapper>
